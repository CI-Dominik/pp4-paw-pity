{% extends 'base.html' %}

{% block content %}

<div class="container">
    <h1 class="text-center">Complaints List</h1>

    {% if complaints %}
    <table class="table table-striped table-responsive-md">
        <thead>
            <tr>
                <th class="text-center">ID (Animal name)</th>
                <th class="text-center">Reason</th>
                <th class="text-center">Created at</th>
                <th class="text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for complaint in complaints %}
            <tr>
                <td class="text-center">{{ complaint.comment.id }} ({{ complaint.comment.animal.name }})</td>
                <td class="text-center">{{ complaint.reason }}</td>
                <td class="text-center">{{ complaint.created_at }}</td>
                <td class="text-center">
                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                        data-bs-target="#delete-comment-modal" data-comment-id="{{ complaint.comment.id }}"><i
                            class="fa-solid fa-check text-white"></i></button>
                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                        data-bs-target="#delete-complaint-modal" data-complaint-id="{{ complaint.id }}"><i
                            class="fa-solid fa-x text-white"></i></button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-center">No complaints found.</p>
    {% endif %}

    <div class="modal fade" id="delete-comment-modal" tabindex="-1" role="dialog"
        aria-labelledby="delete-comment-modal-label" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="delete-comment-modal-label">Delete Comment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the selected comment?</p>
                    <form method="post" id="delete-comment-form">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete-complaint-modal" tabindex="-1" role="dialog"
        aria-labelledby="delete-complaint-modal-label" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="delete-complaint-modal-label">Delete Complaint</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the selected complaint?</p>
                    <form method="post" id="delete-complaint-form">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const deleteCommentModal = document.getElementById('delete-comment-modal');
            const deleteComplaintModal = document.getElementById('delete-complaint-modal');
            const deleteCommentButtons = document.querySelectorAll('[data-bs-toggle="modal"][data-bs-target="#delete-comment-modal"]');
            const deleteComplaintButtons = document.querySelectorAll('[data-bs-toggle="modal"][data-bs-target="#delete-complaint-modal"]');

            deleteCommentButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const commentId = button.getAttribute('data-comment-id');
                    const form = deleteCommentModal.querySelector('#delete-comment-form');
                    form.action = `/complaints/remove_comment/${commentId}/`;
                });
            });

            deleteComplaintButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const complaintId = button.getAttribute('data-complaint-id');
                    const form = deleteComplaintModal.querySelector('#delete-complaint-form');
                    form.action = `/complaints/delete_complaint/${complaintId}/`;
                });
            });
        });
    </script>

    {% endblock %}